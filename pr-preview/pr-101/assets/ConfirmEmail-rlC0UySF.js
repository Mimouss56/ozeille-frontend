import{r as f,j as l}from"./iframe-CsGe54ee.js";import{b as m}from"./chunk-EPOLDU6W-BCmdLwgM.js";import{S as u}from"./StatusMessage-B5P2dmg6.js";import{c as d,a as n,e as i}from"./axiosClient-Bn9sduh9.js";var t=(r=>(r.Idle="idle",r.Pending="pending",r.Success="success",r.Error="error",r))(t||{});const g=d(r=>({isAuthenticated:!1,loading:!1,confirmationStatus:t.Idle,confirmationError:null,confirmationToken:null,user:null,setIsAuthenticated:o=>r({isAuthenticated:o}),resetConfirmationState:()=>r({confirmationStatus:t.Idle,confirmationError:null}),sendConfirmationEmail:async o=>{r({loading:!0});try{await n.post("/auth/register/send-confirmation-email",{email:o})}catch(a){r({confirmationError:i(a)})}finally{r({loading:!1})}},confirmEmail:async o=>{r({confirmationStatus:t.Pending,confirmationError:null});try{const{data:a}=await n.post(`/auth/register/confirm?token=${o}`);return r({confirmationStatus:a===!0?t.Success:t.Error}),a===!0}catch(a){return r({confirmationStatus:t.Error,confirmationError:i(a)}),!1}},confirm2FA:async o=>{r({confirmationStatus:t.Pending,confirmationError:null});try{const{data:a}=await n.post("/auth/2fa/validate",{tempToken:sessionStorage.getItem("tmp_token"),code:o});r({confirmationStatus:a?t.Success:t.Error}),sessionStorage.removeItem("tmp_token"),sessionStorage.setItem("access_token",a.accessToken),sessionStorage.setItem("refresh_token",a.refreshToken);const e=await n.get("/me");return console.log("user",e),r({user:e.data.me,isAuthenticated:!0}),!0}catch(a){return r({confirmationStatus:t.Error,confirmationError:i(a)}),!1}},register:async o=>{r({loading:!0,confirmationStatus:t.Pending,confirmationError:null});try{await n.post("/auth/register",o),r({confirmationStatus:t.Success})}catch(a){r({confirmationStatus:t.Error,confirmationError:i(a)})}finally{r({loading:!1})}},login:async o=>{r({loading:!0});try{const a=await n.post("/auth/login",o);return r({confirmationError:null,confirmationStatus:t.Success,isAuthenticated:!1}),a.data}catch(a){throw r({confirmationError:i(a)}),a}finally{r({loading:!1})}},forgotPassword:async o=>{r({loading:!0,confirmationStatus:t.Pending,confirmationError:null});try{await n.post("/auth/forgot-password",{email:o}),r({confirmationStatus:t.Success})}catch(a){r({confirmationStatus:t.Error,confirmationError:i(a)})}finally{r({loading:!1})}},resetPassword:async(o,a)=>{r({loading:!0});try{await n.post(`/auth/reset-password?token=${o}`,a)}catch(e){r({confirmationError:i(e)})}finally{r({loading:!1})}},fetchMe:async()=>{r({loading:!0,confirmationStatus:t.Pending,confirmationError:null});try{const{data:o}=await n.get("/auth/me");return r({user:o.me,loading:!1,isAuthenticated:!0}),o}catch(o){r({confirmationStatus:t.Error,confirmationError:i(o)})}finally{r({loading:!1})}}}));function h(){const[r]=m(),o=r.get("token"),{confirmEmail:a,confirmationError:e,confirmationStatus:c}=g();f.useEffect(()=>{o&&a(o)},[a,o]);let s="";return c==="pending"?s="Validation en cours...":c==="success"?s="Votre email a bien été confirmé !":c==="error"&&(s=`${e}`),l.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white text-gray-900 antialiased",children:l.jsx("div",{className:"mt-8 w-full max-w-md rounded bg-gray-50 p-6 text-center shadow",children:l.jsx(u,{children:s})})})}h.__docgenInfo={description:"",methods:[],displayName:"ConfirmEmailPage"};export{h as C,t as a,g as u};
