import{r as f,j as l}from"./iframe-w7UQ1iup.js";import{b as m}from"./chunk-EPOLDU6W-B66-AsnY.js";import{S as u}from"./StatusMessage-B00Wiy14.js";import{c as d,a as n,e}from"./axiosClient--JXkQK3L.js";var t=(r=>(r.Idle="idle",r.Pending="pending",r.Success="success",r.Error="error",r))(t||{});const g=d(r=>({isAuthenticated:!1,loading:!1,confirmationStatus:t.Idle,confirmationError:null,confirmationToken:null,user:null,setIsAuthenticated:a=>r({isAuthenticated:a}),resetConfirmationState:()=>r({confirmationStatus:t.Idle,confirmationError:null}),sendConfirmationEmail:async a=>{r({loading:!0});try{await n.post("/auth/register/send-confirmation-email",{email:a})}catch(o){r({confirmationError:e(o)})}finally{r({loading:!1})}},confirmEmail:async a=>{r({confirmationStatus:t.Pending,confirmationError:null});try{const{data:o}=await n.post(`/auth/register/confirm?token=${a}`);return r({confirmationStatus:o===!0?t.Success:t.Error}),o===!0}catch(o){return r({confirmationStatus:t.Error,confirmationError:e(o)}),!1}},confirm2FA:async a=>{r({confirmationStatus:t.Pending,confirmationError:null});try{const{data:o}=await n.post("/auth/2fa/validate",{tempToken:sessionStorage.getItem("tmp_token"),code:a});r({confirmationStatus:o?t.Success:t.Error}),sessionStorage.removeItem("tmp_token"),sessionStorage.setItem("access_token",o.accessToken),sessionStorage.setItem("refresh_token",o.refreshToken);const i=await n.get("/auth/me");return console.log("user",i),r({user:i.data.me,isAuthenticated:!0}),!0}catch(o){return r({confirmationStatus:t.Error,confirmationError:e(o)}),!1}},register:async a=>{r({loading:!0,confirmationStatus:t.Pending,confirmationError:null});try{await n.post("/auth/register",a),r({confirmationStatus:t.Success})}catch(o){r({confirmationStatus:t.Error,confirmationError:e(o)})}finally{r({loading:!1})}},login:async a=>{r({loading:!0});try{const o=await n.post("/auth/login",a);return r({isAuthenticated:!1}),o.data}catch(o){throw r({confirmationError:e(o)}),o}finally{r({loading:!1})}},forgotPassword:async a=>{r({loading:!0,confirmationStatus:t.Pending,confirmationError:null});try{await n.post("/auth/forgot-password",{email:a}),r({confirmationStatus:t.Success})}catch(o){r({confirmationStatus:t.Error,confirmationError:e(o)})}finally{r({loading:!1})}},resetPassword:async(a,o)=>{r({loading:!0});try{await n.post(`/auth/reset-password?token=${a}`,o)}catch(i){r({confirmationError:e(i)})}finally{r({loading:!1})}},fetchMe:async()=>{r({loading:!0,confirmationStatus:t.Pending,confirmationError:null});try{const{data:a}=await n.get("/auth/me");return r({user:a.me,loading:!1,isAuthenticated:!0}),a}catch(a){r({confirmationStatus:t.Error,confirmationError:e(a)})}finally{r({loading:!1})}},logout:()=>{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),r({isAuthenticated:!1,user:null,confirmationStatus:t.Idle,confirmationError:null,confirmationToken:null})}}));function h(){const[r]=m(),a=r.get("token"),{confirmEmail:o,confirmationError:i,confirmationStatus:c}=g();f.useEffect(()=>{a&&o(a)},[o,a]);let s="";return c==="pending"?s="Validation en cours...":c==="success"?s="Votre email a bien été confirmé !":c==="error"&&(s=`${i}`),l.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white text-gray-900 antialiased",children:l.jsx("div",{className:"mt-8 w-full max-w-md rounded bg-gray-50 p-6 text-center shadow",children:l.jsx(u,{layout:"box",children:s})})})}h.__docgenInfo={description:"",methods:[],displayName:"ConfirmEmailPage"};export{h as C,t as a,g as u};
