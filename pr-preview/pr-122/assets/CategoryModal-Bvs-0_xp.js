import{r as f,j as n}from"./iframe-4zMjsTVZ.js";import{_ as I,Z as j,o as v,s as h,u as N,P as S}from"./categoriesStore-C7Xeu528.js";import{a as g,c as A,e as c}from"./axiosClient-BitL05yO.js";import{I as x}from"./InputField-BZcZLCuc.js";import{M as E}from"./Modal-C8GXEIWm.js";import{S as _}from"./Select-BMDyYOcX.js";function T(e){return I(j,e)}const F=v({label:h().min(1,"Le label est requis"),limitAmount:T({invalid_type_error:"Le montant doit être un nombre"}).optional(),budgetId:h().min(1,"Veuillez sélectionner un budget"),color:h().optional()}),L=async()=>{const{data:e}=await g.get("/budgets");return e},M=async e=>{const{data:t}=await g.get(`/budgets/${e}`);return t},P=async e=>{const{data:t}=await g.post("/budgets",e);return t},$=async(e,t)=>{const{data:r}=await g.put(`/budgets/${e}`,t);return r},q=async e=>{await g.delete(`/budgets/${e}`)},z=A(e=>({budgets:[],currentBudget:null,loading:!1,error:null,fetchBudgets:async()=>{e({loading:!0,error:null});try{const t=await L();e({budgets:t,loading:!1})}catch(t){const r=c(t);e({error:r,loading:!1,budgets:[]})}},fetchBudgetById:async t=>{e({loading:!0,error:null});try{const r=await M(t);e({currentBudget:r,loading:!1})}catch(r){const a=c(r);e({error:a,loading:!1,budgets:[]})}},createNewBudget:async t=>{e({loading:!0,error:null});try{const r=await P(t);return e(a=>({budgets:[...a.budgets,r],loading:!1})),r}catch(r){const a=c(r);return e({error:a,loading:!1}),null}},updateCurrentBudget:async(t,r)=>{e({loading:!0,error:null});try{const a=await $(t,r);return e(u=>({budgets:u.budgets.map(m=>m.id===t?a:m),currentBudget:a,loading:!1})),a}catch(a){const u=c(a);return e({error:u,loading:!1}),null}},deleteBudgetById:async t=>{e({loading:!0,error:null});try{await q(t),e(r=>({budgets:r.budgets.filter(a=>a.id!==t),loading:!1}))}catch(r){const a=c(r);e({error:a,loading:!1})}},clearError:()=>e({error:null})})),B={label:"",budgetId:"",color:"#000000",limitAmount:0},Z=({category:e})=>{const{createNewCategory:t,updateCurrentCategory:r}=N(),{budgets:a,fetchBudgets:u}=z(),m=a.map(o=>({label:o.label,value:o.id})),[l,y]=f.useState(B),[d,p]=f.useState({});f.useEffect(()=>{u()},[u]);const C=()=>{y(B),p({})},b=(o,i)=>{y(s=>({...s,[o]:i})),d[o]&&p(s=>({...s,[o]:void 0}))},w=async()=>{const o=F.safeParse(l);if(!o.success){const i={};return o.error.issues.forEach(s=>{s.path[0]&&(i[s.path[0]]=s.message)}),p(i),!1}try{return e?.id?await r(e.id,l):await t(l),C(),!0}catch{return!1}};return n.jsx(E,{title:e?.id?"Modifier la catégorie":"Nouvelle catégorie",actionLabel:e?.id?n.jsx(n.Fragment,{children:n.jsx(S,{size:16})}):"Créer une nouvelle catégorie",confirmLabel:e?"Enregistrer":"Créer",cancelLabel:"Annuler",onConfirm:w,style:e?.id?"ghost":"primary",children:n.jsxs("form",{className:"flex flex-col gap-4 py-2",children:[n.jsx(x,{id:"category-label",name:"label",label:"Nom",value:l.label,onChange:o=>b("label",o),placeholder:"Ex: Alimentation",helperText:d.label,style:d.label?"error":"neutral"}),n.jsx(_,{id:"budgetId",label:"Budget associé",value:l.budgetId,onChange:o=>b("budgetId",o.target.value),options:m,placeholder:"Sélectionner un budget",helperText:d.budgetId,style:d.budgetId?"error":"neutral"}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx("div",{className:"pt-1",children:n.jsx("input",{type:"color",className:"border-base-300 h-10 w-12 cursor-pointer rounded-lg border-2 p-1",value:l.color||"#000000",onChange:o=>b("color",o.target.value)})}),n.jsx("div",{className:"flex-1",children:n.jsx(x,{id:"category-limitAmount",name:"limitAmount",label:"Plafond (€)",type:"number",value:l.limitAmount?.toString(),onChange:o=>b("limitAmount",parseFloat(o)||0),placeholder:"0.00",helperText:d.limitAmount})})]})]})})};Z.__docgenInfo={description:"",methods:[],displayName:"CategoryModal",props:{category:{required:!1,tsType:{name:"Category"},description:""}}};export{Z as C};
