import{r as h,j as l}from"./iframe-L4-B0XMv.js";import{o as I,s as p,u as j,P as N}from"./categoriesStore-Cssjwwq8.js";import{a as g,c as S,e as c}from"./axiosClient-CBSYE6YD.js";import{I as x}from"./InputField-DUgoQAII.js";import{M as v}from"./Modal-ZDcrJLiE.js";import{S as A}from"./Select-Be49-v04.js";const E=I({label:p().min(1,"Le label est requis"),limitAmount:p().refine(e=>e===""||!isNaN(Number(e)),"Le montant doit être un nombre").optional(),budgetId:p().min(1,"Veuillez sélectionner un budget"),color:p().optional()}),T=async()=>{const{data:e}=await g.get("/budgets");return e},F=async e=>{const{data:t}=await g.get(`/budgets/${e}`);return t},L=async e=>{const{data:t}=await g.post("/budgets",e);return t},M=async(e,t)=>{const{data:r}=await g.put(`/budgets/${e}`,t);return r},P=async e=>{await g.delete(`/budgets/${e}`)},_=S(e=>({budgets:[],currentBudget:null,loading:!1,error:null,fetchBudgets:async()=>{e({loading:!0,error:null});try{const t=await T();e({budgets:t,loading:!1})}catch(t){const r=c(t);e({error:r,loading:!1,budgets:[]})}},fetchBudgetById:async t=>{e({loading:!0,error:null});try{const r=await F(t);e({currentBudget:r,loading:!1})}catch(r){const a=c(r);e({error:a,loading:!1,budgets:[]})}},createNewBudget:async t=>{e({loading:!0,error:null});try{const r=await L(t);return e(a=>({budgets:[...a.budgets,r],loading:!1})),r}catch(r){const a=c(r);return e({error:a,loading:!1}),null}},updateCurrentBudget:async(t,r)=>{e({loading:!0,error:null});try{const a=await M(t,r);return e(u=>({budgets:u.budgets.map(m=>m.id===t?a:m),currentBudget:a,loading:!1})),a}catch(a){const u=c(a);return e({error:u,loading:!1}),null}},deleteBudgetById:async t=>{e({loading:!0,error:null});try{await P(t),e(r=>({budgets:r.budgets.filter(a=>a.id!==t),loading:!1}))}catch(r){const a=c(r);e({error:a,loading:!1})}},clearError:()=>e({error:null})})),B={label:"",budgetId:"",color:"#000000",limitAmount:0},$=({category:e})=>{const{createNewCategory:t,updateCurrentCategory:r}=j(),{budgets:a,fetchBudgets:u}=_(),m=a.map(o=>({label:o.label,value:o.id})),[n,y]=h.useState(B),[d,f]=h.useState({});h.useEffect(()=>{u()},[u]);const C=()=>{y(B),f({})},b=(o,i)=>{y(s=>({...s,[o]:i})),d[o]&&f(s=>({...s,[o]:void 0}))},w=async()=>{const o=E.safeParse(n);if(!o.success){const i={};return o.error.issues.forEach(s=>{s.path[0]&&(i[s.path[0]]=s.message)}),f(i),!1}try{return e?.id?await r(e.id,n):await t(n),C(),!0}catch{return!1}};return l.jsx(v,{title:e?.id?"Modifier la catégorie":"Nouvelle catégorie",actionLabel:e?.id?l.jsx(l.Fragment,{children:l.jsx(N,{size:16})}):"Créer une nouvelle catégorie",confirmLabel:e?"Enregistrer":"Créer",cancelLabel:"Annuler",onConfirm:w,style:e?.id?"ghost":"primary",children:l.jsxs("form",{className:"flex flex-col gap-4 py-2",children:[l.jsx(x,{id:"category-label",name:"label",label:"Nom",value:n.label,onChange:o=>b("label",o),placeholder:"Ex: Alimentation",helperText:d.label,style:d.label?"error":"neutral"}),l.jsx(A,{id:"budgetId",label:"Budget associé",value:n.budgetId,onChange:o=>b("budgetId",o.target.value),options:m,placeholder:"Sélectionner un budget",helperText:d.budgetId,style:d.budgetId?"error":"neutral"}),l.jsxs("div",{className:"flex gap-4",children:[l.jsx("div",{className:"pt-1",children:l.jsx("input",{type:"color",className:"border-base-300 h-10 w-12 cursor-pointer rounded-lg border-2 p-1",value:n.color||"#000000",onChange:o=>b("color",o.target.value)})}),l.jsx("div",{className:"flex-1",children:l.jsx(x,{id:"category-limitAmount",name:"limitAmount",label:"Plafond (€)",type:"number",value:n.limitAmount?.toString(),onChange:o=>b("limitAmount",parseFloat(o)||0),placeholder:"0.00",helperText:d.limitAmount})})]})]})})};$.__docgenInfo={description:"",methods:[],displayName:"CategoryModal",props:{category:{required:!1,tsType:{name:"Category"},description:""}}};export{$ as C};
