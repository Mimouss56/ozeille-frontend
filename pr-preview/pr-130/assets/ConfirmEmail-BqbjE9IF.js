import{r as u,j as c}from"./iframe-CHw8J55U.js";import{b as l}from"./chunk-EPOLDU6W-DfNyGYEq.js";import{S as m}from"./StatusMessage-BMMT4Zjg.js";import{c as S,a as n,e as d}from"./axiosClient-Bc8sZMcD.js";var o=(a=>(a.Idle="idle",a.Pending="pending",a.Success="success",a.Error="error",a))(o||{});const f=S((a,t)=>({isAuthenticated:!1,loading:!1,confirmationStatus:o.Idle,confirmationError:null,confirmationToken:null,user:null,setIsAuthenticated:e=>a({isAuthenticated:e}),resetConfirmationState:()=>a({confirmationStatus:o.Idle,confirmationError:null}),setLoadingState:()=>{a({loading:!0,confirmationStatus:o.Pending,confirmationError:null})},setErrorState:e=>{a({loading:!1,confirmationStatus:o.Error,confirmationError:d(e)})},setSuccessState:()=>{a({loading:!1,confirmationStatus:o.Success,confirmationError:null})},setStateOnResult:(e,r)=>{e?t().setSuccessState():t().setErrorState(r)},isConfirmed:()=>t().confirmationStatus===o.Success,sendConfirmationEmail:async e=>{t().setLoadingState();try{await n.post("/auth/register/send-confirmation-email",{email:e}),t().setSuccessState()}catch(r){t().setErrorState(r)}},confirmEmail:async e=>{t().setLoadingState();let r=!1;try{const{data:s}=await n.post(`/auth/register/confirm?token=${e}`);r=s,t().setStateOnResult(s)}catch(s){t().setErrorState(s)}return r},confirm2FA:async e=>{t().setLoadingState();try{const{data:r}=await n.post("/auth/2fa/validate",{tempToken:sessionStorage.getItem("tmp_token"),code:e});a({confirmationStatus:r?o.Success:o.Error}),sessionStorage.removeItem("tmp_token"),sessionStorage.setItem("access_token",r.accessToken),sessionStorage.setItem("refresh_token",r.refreshToken);const s=await n.get("/auth/me");return console.log("user",s),a({user:s.data.me,isAuthenticated:!0}),t().setSuccessState(),!0}catch(r){return t().setErrorState(r),!1}},register:async e=>{t().setLoadingState();try{await n.post("/auth/register",e),t().setSuccessState()}catch(r){t().setErrorState(r)}},login:async e=>{t().setLoadingState();let r;try{r=(await n.post("/auth/login",e)).data,a({isAuthenticated:!1}),t().setSuccessState()}catch(s){t().setErrorState(s)}return r},forgotPassword:async e=>{t().setLoadingState();try{await n.post("/auth/forgot-password",{email:e}),t().setSuccessState()}catch(r){t().setErrorState(r)}},resetPassword:async(e,r)=>{t().setLoadingState();try{await n.post(`/auth/reset-password?token=${e}`,r),t().setSuccessState()}catch(s){t().setErrorState(s)}},fetchMe:async()=>{t().setLoadingState();try{const{data:e}=await n.get("/auth/me");return a({user:e.me,isAuthenticated:!0}),t().setSuccessState(),e}catch(e){t().setErrorState(e)}},logout:()=>{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),a({isAuthenticated:!1,user:null,confirmationStatus:o.Idle,confirmationError:null,confirmationToken:null})}}));function h(){const[a]=l(),t=a.get("token"),{confirmEmail:e,confirmationError:r,confirmationStatus:s}=f();u.useEffect(()=>{t&&e(t)},[e,t]);let i="";return s==="pending"?i="Validation en cours...":s==="success"?i="Votre email a bien été confirmé !":s==="error"&&(i=`${r}`),c.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white text-gray-900 antialiased",children:c.jsx("div",{className:"mt-8 w-full max-w-md rounded bg-gray-50 p-6 text-center shadow",children:c.jsx(m,{layout:"box",children:i})})})}h.__docgenInfo={description:"",methods:[],displayName:"ConfirmEmailPage"};export{h as C,o as a,f as u};
