import{r as c,j as n}from"./iframe-D1x_njIB.js";import{o as v,s as u,n as w,u as E,P as F}from"./categoriesStore-KsVCVhHo.js";import{u as _}from"./frequenciesStore-CEcTECfa.js";import{u as L}from"./transactionsStore-MbJ7U9ZW.js";import{I as m}from"./InputField-BBsj9uw6.js";import{M as D}from"./Modal-BzJfnqQH.js";import{S}from"./Select-09agZMmr.js";const O=v({label:u().min(1,"Le label est requis"),amount:w({invalid_type_error:"Le montant doit être un nombre"}).min(1,"Le montant est requis"),dueAt:u().min(1,"La date est requise"),categoryId:u().min(1,"Veuillez sélectionner une catégorie"),frequencyId:u().min(1,"Veuillez sélectionner une fréquence")}),M=O.extend({pointedAt:u().min(2,"La date est requise")}),i={label:"",amount:"",dueAt:"",frequencyId:"",pointedAt:""},g=e=>({label:e?.id?e.label:i.label,amount:e?.id?e.amount.toString():i.amount,dueAt:e?.id?new Date(e.dueAt).toISOString().slice(0,10):i.dueAt,categoryId:e?.id?e.category.id:"",pointedAt:e?.pointedAt?new Date(e.pointedAt).toISOString().slice(0,10):i.pointedAt,frequencyId:e?.id?e.frequencyId:i.frequencyId}),N=({transaction:e})=>{const{fetchCategories:y,categoriesOptions:q}=E(),{fetchFrequencies:h,frequenciesOptions:x}=_(),{updateCurrentTransaction:I,createNewTransaction:T}=L(),[t,p]=c.useState(()=>g(e)),[r,d]=c.useState({});c.useEffect(()=>{p(g(e))},[e]);const l=o=>f=>{p(a=>({...a,[o]:f})),r[o]&&d(a=>{const s={...a};return delete s[o],s})};c.useEffect(()=>{y(),h()},[y,h]);const A=()=>{p(g(e)),d({})},C=async()=>{const o=M.safeParse(t);if(!o.success){const a={};return o.error.issues.forEach(s=>{s.path[0]&&(a[s.path[0]]=s.message)}),d(a),!1}const f={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString(),pointedAt:new Date(t.pointedAt).toISOString()};try{return e?.id?await I(e.id,f):(await T({...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString()}),A()),!0}catch(a){const s=a;for(const b of s.errors)d(j=>({...j,[b.property]:b.message}));return!1}};return n.jsx(D,{title:e?.id?"Éditer une transaction":"Créer une nouvelle transaction",cancelLabel:"Annuler",actionLabel:e?.id?n.jsxs(n.Fragment,{children:[n.jsx(F,{size:16})," Edit"]}):"Créer une nouvelle transaction",style:e?.id?"ghost":"primary",onConfirm:C,onCancel:A,children:n.jsxs("form",{className:"flex flex-col gap-4",children:[n.jsx(m,{label:"Label",name:"label",id:"transaction_label",value:t.label,placeholder:"Label",onChange:l("label"),style:r.label?"error":"neutral",helperText:r.label}),n.jsx(m,{label:"Montant",name:"amount",id:"transaction_amount",value:t.amount,type:"number",placeholder:"Montant",onChange:l("amount"),style:r.amount?"error":"neutral",helperText:r.amount}),n.jsx(m,{label:"Due le",name:"dueAt",id:"transaction_dueAt",value:t.dueAt,type:"date",placeholder:"Due le",onChange:l("dueAt"),style:r.dueAt?"error":"neutral",helperText:r.dueAt}),e?.id&&n.jsx(m,{label:"Pointé le",name:"pointedAt",id:"transaction_pointedAt",value:t.pointedAt,type:"date",placeholder:"Pointé le",onChange:l("pointedAt"),style:r.pointedAt?"error":"neutral",helperText:r.pointedAt}),n.jsx(S,{id:"transaction_category",name:"category",label:"Categorie",options:q,placeholder:"Choisir une categorie",style:r.categoryId?"error":"neutral",value:t.categoryId,onChange:o=>l("categoryId")(o.target.value),helperText:r.categoryId}),n.jsx(S,{id:"transaction_frequency",name:"frequency",label:"Fréquence",options:x,placeholder:"Choisir une fréquence",style:r.frequencyId?"error":"neutral",value:t.frequencyId,onChange:o=>l("frequencyId")(o.target.value),helperText:r.frequencyId})]})})};N.__docgenInfo={description:"",methods:[],displayName:"TransactionModal",props:{transaction:{required:!1,tsType:{name:"Transaction"},description:""}}};export{N as T};
