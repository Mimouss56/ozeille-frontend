import{r as i}from"./iframe-7V8e0gjq.js";import{c,a as n,e as u}from"./axiosClient-CglRzrQP.js";var a=(s=>(s.Idle="idle",s.Pending="pending",s.Success="success",s.Error="error",s))(a||{});const S=c((s,t)=>({isAuthenticated:!1,loading:!1,confirmationStatus:a.Idle,confirmationError:null,confirmationToken:null,user:null,resetConfirmationState:()=>s({confirmationStatus:a.Idle,confirmationError:null}),setLoadingState:()=>{s({loading:!0,confirmationStatus:a.Pending,confirmationError:null})},isPending:()=>t().confirmationStatus===a.Pending,setErrorState:e=>{s({loading:!1,confirmationStatus:a.Error,confirmationError:u(e)})},isError:()=>t().confirmationStatus===a.Error,setSuccessState:()=>{s({loading:!1,confirmationStatus:a.Success,confirmationError:null})},setStateOnResult:(e,r)=>{e?t().setSuccessState():t().setErrorState(r)},isConfirmed:()=>t().confirmationStatus===a.Success,sendConfirmationEmail:async e=>{t().setLoadingState();try{await n.post("/auth/register/send-confirmation-email",{email:e}),t().setSuccessState()}catch(r){t().setErrorState(r)}},confirmEmail:async e=>{t().setLoadingState();let r=!1;try{r=(await n.post(`/auth/register/confirm?token=${e}`)).status===204,t().setStateOnResult(r)}catch(o){t().setErrorState(o)}return r},confirm2FA:async e=>{t().setLoadingState();try{const{data:r}=await n.post("/auth/2fa/validate",{tempToken:sessionStorage.getItem("tmp_token"),code:e});s({confirmationStatus:r?a.Success:a.Error}),sessionStorage.removeItem("tmp_token"),sessionStorage.setItem("access_token",r.accessToken),sessionStorage.setItem("refresh_token",r.refreshToken);const o=await n.get("/auth/me");return s({user:o.data.me,isAuthenticated:!0}),t().setSuccessState(),!0}catch(r){return t().setErrorState(r),!1}},register:async e=>{t().setLoadingState();try{await n.post("/auth/register",e),t().setSuccessState()}catch(r){t().setErrorState(r)}},login:async e=>{t().setLoadingState();let r;try{r=(await n.post("/auth/login",e)).data,s({isAuthenticated:!1}),t().setSuccessState()}catch(o){t().setErrorState(o)}return r},forgotPassword:async e=>{t().setLoadingState();try{await n.post("/auth/forgot-password",{email:e}),t().setSuccessState()}catch(r){t().setErrorState(r)}},resetPassword:async(e,r)=>{t().setLoadingState();try{await n.post(`/auth/reset-password?token=${e}`,r),t().setSuccessState()}catch(o){t().setErrorState(o)}},fetchMe:async()=>{t().setLoadingState();try{const{data:e}=await n.get("/auth/me");return s({user:e.me,isAuthenticated:!0}),t().setSuccessState(),e}catch(e){t().setErrorState(e)}},logout:()=>{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),s({isAuthenticated:!1,user:null,confirmationStatus:a.Idle,confirmationError:null,confirmationToken:null})}})),f=({children:s})=>{const t=S(e=>e.logout);return i.useEffect(()=>{t()},[t]),s};export{f as C,a,S as u};
