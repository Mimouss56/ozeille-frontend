import{r as m,j as o}from"./iframe-7Am27jV4.js";import{o as E}from"./Pencil.es-zbCCt2YG.js";import{o as F,s as i,u as _}from"./schemas-Dun8JLbt.js";import{n as v}from"./coerce-B3xLU2Qr.js";import{u as L}from"./frequenciesStore-DlDOxZg9.js";import{u as D}from"./transactionsStore-BsXpjJYK.js";import{I as p}from"./InputField-a4XZFb7h.js";import{M as O}from"./Modal-DTBli7gL.js";import{S as q}from"./Select-CwX3uvcF.js";const A=F({label:i().min(1,"Le label est requis"),amount:v({invalid_type_error:"Le montant doit être un nombre"}).min(1,"Le montant est requis"),dueAt:i().min(1,"La date est requise"),categoryId:i().min(1,"Veuillez sélectionner une catégorie"),frequencyId:i().transform(e=>e.trim()===""?void 0:e).optional()}),M=A.extend({pointedAt:i().min(2,"La date est requise"),frequencyId:i().nullable().optional().transform(e=>e==null||e.trim()===""?null:e)}),d={label:"",amount:"",dueAt:"",frequencyId:"",pointedAt:""},y=e=>({label:e?.id?e.label:d.label,amount:e?.id?e.amount.toString():d.amount,dueAt:e?.id?new Date(e.dueAt).toISOString().slice(0,10):d.dueAt,categoryId:e?.id?e.category.id:"",pointedAt:e?.pointedAt?new Date(e.pointedAt).toISOString().slice(0,10):d.pointedAt,frequencyId:e?.id?e.frequencyId:d.frequencyId}),N=({transaction:e})=>{const{fetchCategories:g,categoriesOptions:S}=_(),{fetchFrequencies:h,frequenciesOptions:x}=L(),{updateCurrentTransaction:T,createNewTransaction:C}=D(),[t,f]=m.useState(()=>y(e)),[r,c]=m.useState({});m.useEffect(()=>{f(y(e))},[e]);const l=a=>u=>{f(n=>({...n,[a]:u})),r[a]&&c(n=>{const s={...n};return delete s[a],s})};m.useEffect(()=>{g(),h()},[g,h]);const I=()=>{f(y(e)),c({})},j=async()=>{const a=e?.id?M.safeParse(t):A.safeParse(t);if(!a.success){const n={};return a.error.issues.forEach(s=>{s.path[0]&&(n[s.path[0]]=s.message)}),c(n),!1}let u;e?.id&&(u={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString(),pointedAt:new Date(t.pointedAt).toISOString(),frequencyId:t.frequencyId&&t.frequencyId.trim()!==""?t.frequencyId:null});try{if(e?.id&&u)await T(e.id,u);else{const n={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString()};(!n.frequencyId||n.frequencyId.trim()==="")&&delete n.frequencyId,await C(n),I()}return!0}catch(n){const s=n;for(const b of s.errors)c(w=>({...w,[b.property]:b.message}));return!1}};return o.jsx(O,{title:e?.id?"Éditer une transaction":"Créer une nouvelle transaction",cancelLabel:"Annuler",actionLabel:e?.id?o.jsxs(o.Fragment,{children:[o.jsx(E,{size:16})," Edit"]}):"Créer une nouvelle transaction",style:e?.id?"ghost":"primary",onConfirm:j,onCancel:I,children:o.jsxs("form",{className:"flex flex-col gap-4",children:[o.jsx(p,{label:"Label",name:"label",id:"transaction_label",value:t.label,placeholder:"Label",onChange:l("label"),style:r.label?"error":"neutral",helperText:r.label}),o.jsx(p,{label:"Montant",name:"amount",id:"transaction_amount",value:t.amount,type:"number",placeholder:"Montant",onChange:l("amount"),style:r.amount?"error":"neutral",helperText:r.amount}),o.jsx(p,{label:"Due le",name:"dueAt",id:"transaction_dueAt",value:t.dueAt,type:"date",placeholder:"Due le",onChange:l("dueAt"),style:r.dueAt?"error":"neutral",helperText:r.dueAt}),e?.id&&o.jsx(p,{label:"Pointé le",name:"pointedAt",id:"transaction_pointedAt",value:t.pointedAt,type:"date",placeholder:"Pointé le",onChange:l("pointedAt"),style:r.pointedAt?"error":"neutral",helperText:r.pointedAt}),o.jsx(q,{id:"transaction_category",name:"category",label:"Categorie",options:S,placeholder:"Choisir une categorie",style:r.categoryId?"error":"neutral",value:t.categoryId,onChange:a=>l("categoryId")(a.target.value),helperText:r.categoryId}),o.jsx(q,{id:"transaction_frequency",name:"frequency",label:"Fréquence",options:x,placeholder:"Choisir une fréquence",style:r.frequencyId?"error":"neutral",value:t.frequencyId||"",onChange:a=>l("frequencyId")(a.target.value),helperText:r.frequencyId})]})})};N.__docgenInfo={description:"",methods:[],displayName:"TransactionModal",props:{transaction:{required:!1,tsType:{name:"Transaction"},description:""}}};export{N as T};
