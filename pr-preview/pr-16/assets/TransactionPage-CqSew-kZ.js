import{j as a,r as t}from"./iframe-DBGFD7Qf.js";import{o as w}from"./Pencil.es-DCVW7TdZ.js";import{o as _}from"./Wallet.es-BT0Q6c_X.js";import{B as k}from"./Button-T7zhZpb7.js";import{I as L}from"./InputField-1C7SPRE4.js";import{D as $}from"./DataTable-COxVTQT1.js";import{T as K}from"./TransactionDeleteModal-BMJkn-84.js";import{T as B}from"./TransactionModal-Dbp_qsVQ.js";import{E as V}from"./EmptyCard-Bd1dr-Tq.js";import{d as Y}from"./dayjs.min-DKlP9BWj.js";import{A as G}from"./ActionMenu-e_G5aK1f.js";import{u as H,b as J}from"./frequenciesStore-B7apP9AG.js";import{u as Q}from"./transactionsStore-CtCrxKSw.js";const I=({value:u,onChange:o,placeholder:c="Rechercher...",label:l})=>a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:l}),a.jsx("input",{type:"text",placeholder:c,value:u,onChange:i=>o(i.target.value),className:"input input-bordered input-xs",onClick:i=>i.stopPropagation()})]});I.__docgenInfo={description:"",methods:[],displayName:"FilterInput",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},placeholder:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Rechercher..."',computed:!1}},label:{required:!0,tsType:{name:"string"},description:""}}};const q=({value:u,onChange:o,options:c,label:l,emptyLabel:i="Toutes"})=>a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"text-sm font-medium",children:l}),a.jsxs("select",{value:u,onChange:s=>o(s.target.value),className:"select select-bordered select-xs",onClick:s=>s.stopPropagation(),children:[a.jsx("option",{value:"",children:i}),c.map(s=>a.jsx("option",{value:s.id,children:s.label},s.id))]})]});q.__docgenInfo={description:"",methods:[],displayName:"FilterSelect",props:{value:{required:!0,tsType:{name:"string"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},options:{required:!0,tsType:{name:"Array",elements:[{name:"FilterSelectOption"}],raw:"FilterSelectOption[]"},description:""},label:{required:!0,tsType:{name:"string"},description:""},emptyLabel:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Toutes"',computed:!1}}}};const U=()=>Y().startOf("month").format("YYYY-MM");function W(){const[u,o]=t.useState(void 0),[c,l]=t.useState(!1),[i,s]=t.useState(!1),[g,y]=t.useState(()=>U()),[n,b]=t.useState({category:"",label:"",amount:""}),{fetchTransactions:h,meta:T,transactions:C}=Q(),{fetchCategories:f,categories:m}=H(),{fetchFrequencies:N,frequencies:E}=J(),p=10,[M,v]=t.useState({pageIndex:0,pageSize:p}),D=t.useCallback(e=>{y(e),v({pageIndex:0,pageSize:p})},[]),x=t.useCallback((e,r)=>{b(d=>({...d,[e]:r})),v({pageIndex:0,pageSize:p})},[]),F=t.useCallback(()=>{b({category:"",label:"",amount:""}),v({pageIndex:0,pageSize:p})},[]),O=t.useCallback(()=>{o(void 0),l(!0)},[]),j=t.useCallback(e=>{o(e),l(!0)},[]),S=t.useCallback(e=>{o(e),s(!0)},[]),A=t.useCallback(()=>{l(!1),s(!1),o(void 0)},[]),P=t.useCallback(e=>[{label:"Éditer",style:"outline",onClick:()=>j(e)},{label:"Supprimer",style:"dangerOutline",onClick:()=>S(e)}],[j,S]),R=t.useMemo(()=>[{accessorKey:"dueAt",header:"Date",cell:({row:e})=>new Date(e.original.dueAt).toLocaleDateString()},{accessorKey:"category",header:()=>t.createElement(q,{value:n.category,onChange:e=>x("category",e),options:m,label:"Catégorie"}),cell:({row:e})=>e.original.categoryId?`${e.original.category?.label}`:"Aucune catégorie"},{accessorKey:"amount",header:()=>t.createElement(I,{value:n.amount,onChange:e=>x("amount",e),label:"Montant",placeholder:"Rechercher..."}),cell:({row:e})=>{const r=Number(e.original.amount).toFixed(2),d=e.original.category?.type==="INCOME";return t.createElement("span",{className:`font-medium ${d?"text-green-600":"text-red-600"}`},`${d?"+":""} ${r} €`)}},{accessorKey:"label",header:()=>t.createElement(I,{value:n.label,onChange:e=>x("label",e),label:"Libellé",placeholder:"Rechercher..."})},{id:"actions",header:"",cell:({row:e})=>t.createElement(G,{actions:P(e.original)})}],[P,n,m,x]);t.useEffect(()=>{m.length===0&&f(),E.length===0&&N()},[m.length,f,N,E.length]),t.useEffect(()=>{const e=Y(g,"YYYY-MM").startOf("month").format("YYYY-MM-DD"),r=Y(g,"YYYY-MM").endOf("month").format("YYYY-MM-DD");h({limit:p,page:M.pageIndex+1,from:e,to:r})},[h,p,M.pageIndex,g]);const z=t.useMemo(()=>{let e=C;if(n.category&&(e=e.filter(r=>r.categoryId===n.category)),n.label.trim()){const r=n.label.toLowerCase();e=e.filter(d=>d.label.toLowerCase().includes(r))}if(n.amount.trim()){const r=n.amount;e=e.filter(d=>Math.abs(Number(d.amount)).toString().includes(r))}return e},[C,n]);return{columns:R,fetchTransactions:h,meta:T,transactions:z,isEditModalOpen:c,isDeleteModalOpen:i,selectedTransaction:u,handleCreate:O,handleEdit:j,handleDelete:S,closeModals:A,page:M,setPage:v,limit:p,period:g,handlePeriodChange:D,categories:m,filters:n,handleFilterChange:x,handleResetFilters:F}}const X=()=>{const{columns:u,meta:o,transactions:c,isEditModalOpen:l,isDeleteModalOpen:i,selectedTransaction:s,handleCreate:g,closeModals:y,page:n,setPage:b,limit:h,period:T,handlePeriodChange:C,filters:f,handleResetFilters:m}=W();return a.jsxs("div",{className:"flex h-full flex-col gap-4",children:[a.jsx("h1",{className:"text-neutral text-2xl font-bold",children:"Transactions"}),a.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[a.jsx(L,{id:"transaction-period",label:"Période",name:"period",type:"month",value:T,onChange:C,size:"sm",placeholder:""}),a.jsxs("div",{className:"flex gap-2",children:[(f.category||f.label||f.amount)&&a.jsx(k,{onClick:m,style:"ghost",size:"sm",children:"Réinitialiser filtres"}),a.jsx(k,{onClick:g,icon:w,children:"Nouvelle Transaction"})]})]}),c.length===0&&a.jsx(V,{icon:_,label:"Aucune transaction",subtitle:"Ajouter une nouvelle transaction"}),a.jsx($,{pageSize:h,data:c,columns:u,currentPage:n,setCurrentPage:b,totalPage:o.totalPages,paginated:!0}),l&&a.jsx(B,{transaction:s,onClose:y}),i&&s&&a.jsx(K,{transaction:s,onClose:y})]})};X.__docgenInfo={description:"",methods:[],displayName:"TransactionPage"};export{X as T};
