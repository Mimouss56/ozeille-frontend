import{r as t,j as o}from"./iframe-B-qyafta.js";import{o as A}from"./Pencil.es-D-GEjPrN.js";import{o as k}from"./Wallet.es-DXQ6i8mL.js";import{B as v}from"./Button-D6m03S5f.js";import{I as F}from"./InputField-BUFJBREF.js";import{D as N}from"./DataTable-BIf2JUFx.js";import{T as $}from"./TransactionDeleteModal-tQ1vOu_0.js";import{T as z}from"./TransactionModal-BFf8IPPm.js";import{E as K}from"./EmptyCard-D1_alWgn.js";import{d as M}from"./dayjs.min-BpQ9T9v0.js";import{A as _}from"./ActionMenu-Bfu4MdUL.js";import{u as q,b as L}from"./frequenciesStore-BphXcCtr.js";import{u as w}from"./transactionsStore-v-69FRk-.js";function j(d,s={}){const{currency:r="€",decimals:l=2,currencyPosition:u="after"}=s,a=d.toFixed(l),n=u==="after"?`${a} ${r}`:`${r} ${a}`,i=`${d>0?"text-green-600":"text-red-600"} font-medium`;return t.createElement("span",{className:i},n)}j.__docgenInfo={description:"",methods:[],displayName:"formatAmountWithColor"};const B=()=>M().startOf("month").format("YYYY-MM");function R(){const[d,s]=t.useState(void 0),[r,l]=t.useState(!1),[u,a]=t.useState(!1),[n,m]=t.useState(()=>B()),{fetchTransactions:i,meta:g,transactions:h}=w(),{fetchCategories:p,categories:c}=q(),{fetchFrequencies:Y,frequencies:y}=L(),f=10,[x,T]=t.useState({pageIndex:0,pageSize:f}),D=t.useCallback(e=>{m(e),T({pageIndex:0,pageSize:f})},[]),S=t.useCallback(()=>{s(void 0),l(!0)},[]),b=t.useCallback(e=>{s(e),l(!0)},[]),C=t.useCallback(e=>{s(e),a(!0)},[]),E=t.useCallback(()=>{l(!1),a(!1),s(void 0)},[]),P=t.useCallback(e=>[{label:"Éditer",style:"outline",onClick:()=>b(e)},{label:"Supprimer",style:"dangerOutline",onClick:()=>C(e)}],[b,C]),I=t.useMemo(()=>[{accessorKey:"dueAt",header:"Date",cell:({row:e})=>new Date(e.original.dueAt).toLocaleDateString()},{accessorKey:"category",header:"Catégorie",cell:({row:e})=>e.original.categoryId?`${e.original.category?.label}`:"Aucune catégorie",enableFiltering:!0,options:{filterOptions:c.map(e=>({id:e.id,label:e.label})),filterEmptyLabel:"Toutes"}},{accessorKey:"amount",header:"Montant",cell:({row:e})=>j(e.original.amount),enableFiltering:!0,options:{filterPlaceholder:""},currency:!0},{accessorKey:"label",header:"Libellé",enableFiltering:!0,options:{filterPlaceholder:"Rechercher un libellé..."}},{id:"actions",header:"",cell:({row:e})=>t.createElement(_,{actions:P(e.original)})}],[P,c]);return t.useEffect(()=>{c.length===0&&p(),y.length===0&&Y()},[c.length,p,Y,y.length]),t.useEffect(()=>{const e=M(n,"YYYY-MM").startOf("month").format("YYYY-MM-DD"),O=M(n,"YYYY-MM").endOf("month").format("YYYY-MM-DD");i({limit:f,page:x.pageIndex+1,from:e,to:O})},[i,f,x.pageIndex,n]),{columns:I,fetchTransactions:i,meta:g,transactions:h,isEditModalOpen:r,isDeleteModalOpen:u,selectedTransaction:d,handleCreate:S,handleEdit:b,handleDelete:C,closeModals:E,page:x,setPage:T,limit:f,period:n,handlePeriodChange:D,categories:c}}const W=()=>{const{columns:d,meta:s,transactions:r,isEditModalOpen:l,isDeleteModalOpen:u,selectedTransaction:a,handleCreate:n,closeModals:m,page:i,setPage:g,limit:h,period:p,handlePeriodChange:c}=R();return o.jsxs("div",{className:"flex h-full flex-col gap-4",children:[o.jsx("h1",{className:"text-neutral text-2xl font-bold",children:"Transactions"}),o.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[o.jsx(F,{id:"transaction-period",label:"Période",name:"period",type:"month",value:p,onChange:c,size:"sm",placeholder:""}),o.jsx(v,{onClick:n,icon:A,children:"Nouvelle Transaction"})]}),r.length===0&&o.jsx(K,{icon:k,label:"Aucune transaction",subtitle:"Ajouter une nouvelle transaction"}),o.jsx(N,{pageSize:h,data:r,columns:d,currentPage:i,setCurrentPage:g,totalPage:s.totalPages,paginated:!0}),l&&o.jsx(z,{transaction:a,onClose:m}),u&&a&&o.jsx($,{transaction:a,onClose:m})]})};W.__docgenInfo={description:"",methods:[],displayName:"TransactionPage"};export{W as T};
