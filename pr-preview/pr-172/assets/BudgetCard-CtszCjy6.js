import{r as g,j as e}from"./iframe-B10ShIjv.js";import{c as j}from"./index-DutoEiXV.js";import{A as N}from"./ActionMenu-BShjyCzW.js";import{D as S}from"./Dot-BQdBTF6g.js";import{P as p}from"./ProgressBar-C7uTlrZ4.js";import{o as v}from"./PencilSimple.es-BisvWU86.js";import{r as B}from"./Trash.es-DPHwRnd9.js";import"./schemas-YR227CNF.js";import{u as w}from"./budgetsStore-B64BGgYd.js";import"./frequenciesStore-CdWHvc19.js";import"./transactionsStore-Buxf9DMW.js";import{B as C}from"./BudgetModal-zlWjDeoT.js";function E(s,l,m){const i=(a,c)=>a===0?u.Neutral:a>c?u.Error:a===c?u.Warning:u.Success,t=g.useMemo(()=>i(s,l),[s,l]),r=g.useMemo(()=>m?.map(a=>({id:a.id,status:i(a.currentAmount,a.limitAmount)}))??[],[m]);return{globalStatus:t,categoriesStatus:r}}function y(s){const{deleteBudgetById:l}=w(),m=g.useMemo(()=>{const n=s?.budget?.id;return n?[{label:"Éditer budget",icon:v,render:g.createElement(C,{budget:s.budget}),style:"ghost"},{label:"Supprimer",icon:B,style:"danger",onClick:()=>l(n)}]:[]},[l,s]),i=g.useMemo(()=>{const n=new Intl.NumberFormat("fr-FR",{notation:"compact",compactDisplay:"short"});return(x,f)=>`${n.format(x)} / ${n.format(f)}`},[]),t=g.useMemo(()=>{const{budget:n}=s,b=(n.categories??[]).filter(o=>o.type==="EXPENSE"||!o.type).map(o=>{const d=(o.transactions??[]).reduce((A,h)=>A+Math.abs(h.amount),0);return{id:o.id,label:o.label,currentAmount:d,limitAmount:Number(o.limitAmount),ratio:i(d,Number(o.limitAmount))}});return{id:n.id,label:n.label,currentAmount:b.reduce((o,d)=>o+d.currentAmount,0),limitAmount:b.reduce((o,d)=>o+d.limitAmount,0),categories:b}},[i,s]),{globalStatus:r,categoriesStatus:a}=E(t.currentAmount,t.limitAmount,t.categories),c={color:s.budget.color||"#000",globalStatus:r,categoriesStatus:a,label:s.budget.label,currentAmount:t.currentAmount,limitAmount:t.limitAmount,ratio:i(t.currentAmount,t.limitAmount),categories:t.categories};return{menuActions:m,globalStatus:r,categoriesStatus:a,formattedBudget:c}}const u={Neutral:"neutral",Success:"success",Warning:"warning",Error:"error"},M=j(["card bg-base-100 w-full rounded-md border lg:mx-auto"],{variants:{status:{[u.Neutral]:"border-neutral",[u.Success]:"border-success",[u.Warning]:"border-warning",[u.Error]:"border-error"}},defaultVariants:{status:u.Neutral}}),D=({budget:s})=>{const{menuActions:l,globalStatus:m,categoriesStatus:i,formattedBudget:t}=y({budget:s,onEditTransaction(r){console.log("(ouverture modal) Ajout transaction pour le budget avec id :",r)},onAddCategories(r){console.log("(ouverture modal) Ajout catégorie pour le budget avec id :",r)}});return e.jsx("div",{className:M({status:t.globalStatus}),children:e.jsxs("div",{className:"card-body p-4! shadow-lg sm:p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-3",children:[e.jsx(S,{color:t.color}),e.jsx("h2",{className:"card-title text-neutral text-md truncate font-extrabold sm:text-xl",title:t.label,children:t.label})]}),e.jsx(N,{actions:l})]}),e.jsxs("div",{className:"mb-5 flex items-center justify-between gap-2 sm:gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(p,{value:t.currentAmount,max:t.limitAmount,color:t.globalStatus,className:"h-2.5"})}),e.jsx("div",{className:"text-neutral w-fit text-right text-sm font-semibold",children:t.ratio})]}),e.jsx("hr",{className:"bg-base-300 mb-5 h-px w-full border-none"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[t.categories.map(r=>{const a=i.find(c=>c.id===r.id)?.status??m;return e.jsxs("div",{className:"flex items-center justify-between gap-x-4 gap-y-1 text-sm",children:[e.jsx("span",{className:"text-neutral w-2/3 truncate text-base font-medium",title:r.label,children:r.label}),e.jsx(p,{value:r.currentAmount,max:r.limitAmount,color:a,className:"h-2"}),e.jsx("span",{className:"text-neutral w-1/3 text-right font-medium whitespace-nowrap",children:r.ratio})]},r.id)}),t.categories.length===0&&e.jsx("p",{className:"text-neutral/40 py-2 text-center text-sm italic",children:"Aucune catégorie"})]})]})})};D.__docgenInfo={description:"",methods:[],displayName:"BudgetCard"};export{D as B};
