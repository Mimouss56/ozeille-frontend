import{r as i}from"./iframe-B10ShIjv.js";import{c,a as n,e as u}from"./axiosClient-BFG-t0KE.js";var a=(s=>(s.Idle="idle",s.Pending="pending",s.Success="success",s.Error="error",s))(a||{});const S=c((s,t)=>({isAuthenticated:!1,loading:!1,confirmationStatus:a.Idle,confirmationError:null,fieldErrors:null,confirmationToken:null,user:null,resetConfirmationState:()=>s({confirmationStatus:a.Idle,confirmationError:null}),setLoadingState:()=>{s({loading:!0,confirmationStatus:a.Pending,confirmationError:null})},isPending:()=>t().confirmationStatus===a.Pending,setErrorState:r=>{s({loading:!1,confirmationStatus:a.Error,confirmationError:u(r)})},isError:()=>t().confirmationStatus===a.Error,setSuccessState:()=>{s({loading:!1,confirmationStatus:a.Success,confirmationError:null})},setStateOnResult:(r,e)=>{r?t().setSuccessState():t().setErrorState(e)},isConfirmed:()=>t().confirmationStatus===a.Success,sendConfirmationEmail:async r=>{t().setLoadingState();try{await n.post("/auth/register/send-confirmation-email",{email:r}),t().setSuccessState()}catch(e){t().setErrorState(e)}},confirmEmail:async r=>{t().setLoadingState();let e=!1;try{e=(await n.post(`/auth/register/confirm?token=${r}`)).status===204,t().setStateOnResult(e)}catch(o){t().setErrorState(o)}return e},confirm2FA:async r=>{t().setLoadingState();try{const{data:e}=await n.post("/auth/2fa/validate",{tempToken:sessionStorage.getItem("tmp_token"),code:r});s({confirmationStatus:e?a.Success:a.Error}),sessionStorage.removeItem("tmp_token"),sessionStorage.setItem("access_token",e.accessToken),sessionStorage.setItem("refresh_token",e.refreshToken);const o=await n.get("/auth/me");return s({user:o.data.me,isAuthenticated:!0}),t().setSuccessState(),!0}catch(e){return t().setErrorState(e),!1}},register:async r=>{t().setLoadingState();try{await n.post("/auth/register",r),t().setSuccessState()}catch(e){t().setErrorState(e)}},login:async r=>{t().setLoadingState();let e;try{e=(await n.post("/auth/login",r)).data,s({isAuthenticated:!1}),t().setSuccessState()}catch(o){t().setErrorState(o)}return e},forgotPassword:async r=>{t().setLoadingState();try{await n.post("/auth/forgot-password",{email:r}),t().setSuccessState()}catch(e){t().setErrorState(e)}},resetPassword:async(r,e)=>{t().setLoadingState();try{await n.post(`/auth/reset-password?token=${r}`,e),t().setSuccessState()}catch(o){t().setErrorState(o)}},fetchMe:async()=>{t().setLoadingState();try{const{data:r}=await n.get("/auth/me");return s({user:r.me,isAuthenticated:!0}),t().setSuccessState(),r}catch(r){t().setErrorState(r)}},logout:()=>{sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),s({isAuthenticated:!1,user:null,confirmationStatus:a.Idle,confirmationError:null,confirmationToken:null})}})),f=({children:s})=>{const t=S(r=>r.logout);return i.useEffect(()=>{t()},[t]),s};export{f as C,a,S as u};
