import{r as h,j as o}from"./iframe-ARFA_WIw.js";import{o as j}from"./Pencil.es-dzUL0D3_.js";import{I as b}from"./InputField--K3d8j6w.js";import{M as w}from"./Modal-nNssXsfy.js";import{S}from"./Select-DPynZv9y.js";import{o as F,s as d,u as _}from"./schemas-Dugkjyeq.js";import{n as v}from"./coerce-BTYGIiUs.js";import{u as E}from"./frequenciesStore-C_gWD7Ig.js";import{u as O}from"./transactionsStore-CTqPHbhw.js";const x=F({label:d().min(1,"Le label est requis"),amount:v({invalid_type_error:"Le montant doit être un nombre"}).min(1,"Le montant est requis"),dueAt:d().min(1,"La date est requise"),categoryId:d().min(1,"Veuillez sélectionner une catégorie"),frequencyId:d().transform(e=>e.trim()===""?void 0:e).optional()}),L=x.extend({pointedAt:d().optional().nullable(),frequencyId:d().nullable().optional().transform(e=>e==null||e.trim()===""?null:e)}),f={label:"",amount:"",dueAt:"",frequencyId:"",pointedAt:""},A=e=>({label:e?.id?e.label:f.label,amount:e?.id?e.amount.toString():f.amount,dueAt:e?.id?new Date(e.dueAt).toISOString().slice(0,10):f.dueAt,categoryId:e?.id?e.category?.id:"",pointedAt:e?.pointedAt?new Date(e.pointedAt).toISOString().slice(0,10):f.pointedAt,frequencyId:e?.id?e.frequencyId:f.frequencyId}),D=e=>{const{categoriesOptions:c,fetchCategoriesOptions:y}=_(),{frequenciesOptions:a}=E(),{updateCurrentTransaction:r,createNewTransaction:l}=O(),[t,m]=h.useState(()=>A(e)),[i,g]=h.useState({});h.useEffect(()=>{c.length==0&&y({limit:100,page:1})},[c.length,y]),h.useEffect(()=>{m(A(e))},[e]);const T=u=>p=>{m(n=>({...n,[u]:p})),i[u]&&g(n=>{const s={...n};return delete s[u],s})},I=()=>{m(A(e)),g({})};return{handleSubmit:async()=>{const u=e?.id?L.safeParse(t):x.safeParse(t);if(!u.success){const n={};return u.error.issues.forEach(s=>{s.path[0]&&(n[s.path[0]]=s.message)}),g(n),!1}let p;e?.id&&(p={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString(),pointedAt:t.pointedAt?new Date(t.pointedAt).toISOString():null,frequencyId:t.frequencyId&&t.frequencyId.trim()!==""?t.frequencyId:null});try{if(e?.id&&p)await r(e.id,p);else{const n={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString()};(!n.frequencyId||n.frequencyId.trim()==="")&&delete n.frequencyId,await l(n),I()}return!0}catch(n){const s=n;for(const q of s.errors)g(C=>({...C,[q.property]:q.message}));return!1}},resetForm:I,formState:t,errors:i,handleChange:T,categoriesOptions:c,frequencies:a}},M=({transaction:e})=>{const{handleSubmit:c,resetForm:y,formState:a,errors:r,handleChange:l,categoriesOptions:t,frequencies:m}=D(e);return o.jsx(w,{title:e?.id?"Éditer une transaction":"Créer une nouvelle transaction",cancelLabel:"Annuler",actionLabel:e?.id?o.jsxs(o.Fragment,{children:[o.jsx(j,{size:16})," Éditer la transaction"]}):"Créer une nouvelle transaction",style:e?.id?"ghost":"primary",onConfirm:c,onCancel:y,children:o.jsxs("form",{className:"flex flex-col gap-4",children:[o.jsx(b,{label:"Label",name:"label",id:"transaction_label",value:a.label,placeholder:"Label",onChange:l("label"),style:r.label?"error":"neutral",helperText:r.label}),o.jsx(b,{label:"Montant",name:"amount",id:"transaction_amount",value:a.amount,type:"number",placeholder:"Montant",onChange:l("amount"),style:r.amount?"error":"neutral",helperText:r.amount}),o.jsx(b,{label:"Due le",name:"dueAt",id:"transaction_dueAt",value:a.dueAt,type:"date",placeholder:"Due le",onChange:l("dueAt"),style:r.dueAt?"error":"neutral",helperText:r.dueAt}),e?.id&&o.jsx(b,{label:"Pointé le",name:"pointedAt",id:"transaction_pointedAt",value:a.pointedAt,type:"date",placeholder:"Pointé le",onChange:l("pointedAt"),style:r.pointedAt?"error":"neutral",helperText:r.pointedAt}),o.jsx(S,{id:"transaction_category",name:"category",label:"Categorie",options:t,placeholder:"Choisir une categorie",style:r.categoryId?"error":"neutral",value:a.categoryId,onChange:i=>l("categoryId")(i.target.value),helperText:r.categoryId}),o.jsx(S,{id:"transaction_frequency",name:"frequency",label:"Fréquence",options:m,placeholder:"Choisir une fréquence",style:r.frequencyId?"error":"neutral",value:a.frequencyId||"",onChange:i=>l("frequencyId")(i.target.value),helperText:r.frequencyId})]})})};M.__docgenInfo={description:"",methods:[],displayName:"TransactionModal",props:{transaction:{required:!1,tsType:{name:"Transaction"},description:""}}};export{M as T};
