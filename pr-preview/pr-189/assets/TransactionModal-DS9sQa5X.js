import{r as h,j as a}from"./iframe-B0cFNXg8.js";import{I as b}from"./InputField-BOZNpJnX.js";import{M as j}from"./Modal-DyPYsrK4.js";import{S as x}from"./Select-CB_N0uVl.js";import{o as v,s as c,u as w}from"./schemas-XSs--JG5.js";import{n as O}from"./coerce-BNYhjipM.js";import{u as E}from"./frequenciesStore-Cew-QqY2.js";import{u as _}from"./transactionsStore-mfnfGV1I.js";const A=v({label:c().min(1,"Le label est requis"),amount:O({invalid_type_error:"Le montant doit être un nombre"}).min(1,"Le montant est requis"),dueAt:c().min(1,"La date est requise"),categoryId:c().min(1,"Veuillez sélectionner une catégorie"),frequencyId:c().transform(e=>e.trim()===""?void 0:e).optional()}),D=A.extend({pointedAt:c().optional().nullable(),frequencyId:c().nullable().optional().transform(e=>e==null||e.trim()===""?null:e)}),p={label:"",amount:"",dueAt:"",frequencyId:"",pointedAt:""},I=e=>({label:e?.id?e.label:p.label,amount:e?.id?e.amount.toString():p.amount,dueAt:e?.id?new Date(e.dueAt).toISOString().slice(0,10):p.dueAt,categoryId:e?.id?e.category?.id:"",pointedAt:e?.pointedAt?new Date(e.pointedAt).toISOString().slice(0,10):p.pointedAt,frequencyId:e?.id?e.frequencyId:p.frequencyId}),F=e=>{const{categoriesOptions:u,fetchCategoriesOptions:g}=w(),{frequenciesOptions:l}=E(),{updateCurrentTransaction:n,createNewTransaction:i}=_(),[t,m]=h.useState(()=>I(e)),[o,y]=h.useState({});h.useEffect(()=>{u.length==0&&g({limit:100,page:1})},[u.length,g]),h.useEffect(()=>{m(I(e))},[e]);const T=d=>f=>{m(r=>({...r,[d]:f})),o[d]&&y(r=>{const s={...r};return delete s[d],s})},q=()=>{m(I(e)),y({})};return{handleSubmit:async()=>{const d=e?.id?D.safeParse(t):A.safeParse(t);if(!d.success){const r={};return d.error.issues.forEach(s=>{s.path[0]&&(r[s.path[0]]=s.message)}),y(r),!1}let f;e?.id&&(f={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString(),pointedAt:t.pointedAt?new Date(t.pointedAt).toISOString():null,frequencyId:t.frequencyId&&t.frequencyId.trim()!==""?t.frequencyId:null});try{if(e?.id&&f)await n(e.id,f);else{const r={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString()};(!r.frequencyId||r.frequencyId.trim()==="")&&delete r.frequencyId,await i(r),q()}return!0}catch(r){const s=r;for(const S of s.errors)y(C=>({...C,[S.property]:S.message}));return!1}},resetForm:q,formState:t,errors:o,handleChange:T,categoriesOptions:u,frequencies:l}},L=({transaction:e,onClose:u})=>{const{handleSubmit:g,formState:l,errors:n,handleChange:i,categoriesOptions:t,frequencies:m}=F(e);return a.jsx(j,{isOpen:!0,onClose:u,onCancel:u,title:e?.id?"Éditer une transaction":"Créer une nouvelle transaction",cancelLabel:"Annuler",confirmLabel:e?.id?"Modifier":"Créer",onConfirm:g,children:a.jsxs("form",{className:"flex flex-col gap-4",onSubmit:o=>o.preventDefault(),children:[a.jsx(b,{label:"Label",name:"label",id:"transaction_label",value:l.label,placeholder:"Label",onChange:i("label"),style:n.label?"error":"neutral",helperText:n.label}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx(b,{label:"Montant",name:"amount",id:"transaction_amount",value:l.amount,type:"number",placeholder:"Montant",onChange:i("amount"),style:n.amount?"error":"neutral",helperText:n.amount})}),a.jsx("div",{className:"flex-1",children:a.jsx(b,{label:"Due le",name:"dueAt",id:"transaction_dueAt",value:l.dueAt,type:"date",placeholder:"Due le",onChange:i("dueAt"),style:n.dueAt?"error":"neutral",helperText:n.dueAt})})]}),a.jsx(x,{id:"transaction_category",name:"category",label:"Categorie",options:t,placeholder:"Choisir une categorie",style:n.categoryId?"error":"neutral",value:l.categoryId,onChange:o=>i("categoryId")(o.target.value),helperText:n.categoryId}),a.jsx(x,{id:"transaction_frequency",name:"frequency",label:"Fréquence",options:m,placeholder:"Choisir une fréquence",style:n.frequencyId?"error":"neutral",value:l.frequencyId||"",onChange:o=>i("frequencyId")(o.target.value),helperText:n.frequencyId})]})})};L.__docgenInfo={description:"",methods:[],displayName:"TransactionModal",props:{transaction:{required:!1,tsType:{name:"Transaction"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{L as T};
