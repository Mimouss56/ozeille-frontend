import{r as h,j as a}from"./iframe-z1zinKTN.js";import{I}from"./InputField-CtrHOFbz.js";import{S as A}from"./Select-D6UU11Tu.js";import{M as v}from"./Modal-DWyekP3_.js";import{o as w,s as d}from"./schemas-D3hWGOKU.js";import{n as O}from"./coerce-Cd9CS-hv.js";import{u as E,b as _}from"./frequenciesStore-B3b6Rooe.js";import{u as F}from"./transactionsStore-Bnn0k51I.js";const T=w({label:d().min(1,"Le label est requis"),amount:O({invalid_type_error:"Le montant doit être un nombre"}).refine(e=>e!==0,"Le montant ne peut pas être zéro"),dueAt:d().min(1,"La date est requise"),categoryId:d().min(1,"Veuillez sélectionner une catégorie"),frequencyId:d().transform(e=>e.trim()===""?void 0:e).optional()}),L=T.extend({pointedAt:d().optional().nullable(),frequencyId:d().nullable().optional().transform(e=>e==null||e.trim()===""?null:e)}),f={label:"",amount:"",dueAt:"",frequencyId:"",pointedAt:""},q=e=>({label:e?.id?e.label:f.label,amount:e?.id?e.amount.toString():f.amount,dueAt:e?.id?new Date(e.dueAt).toISOString().slice(0,10):f.dueAt,categoryId:e?.id?e.category?.id:"",pointedAt:e?.pointedAt?new Date(e.pointedAt).toISOString().slice(0,10):f.pointedAt,frequencyId:e?.id?e.frequencyId:f.frequencyId}),M=e=>{const{categoriesOptions:p,fetchCategoriesOptions:g}=E(),{frequenciesOptions:s}=_(),{updateCurrentTransaction:n,createNewTransaction:l,loading:b}=F(),[t,c]=h.useState(()=>q(e)),[i,y]=h.useState({});h.useEffect(()=>{g({limit:100,page:1})},[g]),h.useEffect(()=>{c(q(e))},[e]);const C=u=>m=>{c(r=>({...r,[u]:m})),i[u]&&y(r=>{const o={...r};return delete o[u],o})},S=()=>{c(q(e)),y({})};return{handleSubmit:async()=>{const u=e?.id?L.safeParse(t):T.safeParse(t);if(!u.success){const r={};return u.error.issues.forEach(o=>{o.path[0]&&(r[o.path[0]]=o.message)}),y(r),!1}let m;e?.id&&(m={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString(),pointedAt:t.pointedAt?new Date(t.pointedAt).toISOString():null,frequencyId:t.frequencyId&&t.frequencyId.trim()!==""?t.frequencyId:null});try{if(e?.id&&m)await n(e.id,m);else{const r={...t,amount:Number(t.amount),dueAt:new Date(t.dueAt).toISOString()};(!r.frequencyId||r.frequencyId.trim()==="")&&delete r.frequencyId,await l(r),S()}return!0}catch(r){const o=r;for(const x of o.errors)y(j=>({...j,[x.property]:x.message}));return!1}},resetForm:S,formState:t,errors:i,handleChange:C,categoriesOptions:p,frequencies:s,loading:b}},N=({transaction:e,onClose:p})=>{const{handleSubmit:g,formState:s,errors:n,handleChange:l,categoriesOptions:b,frequencies:t,loading:c}=M(e);return a.jsx(v,{loading:c,isOpen:!0,onClose:p,onCancel:p,title:e?.id?"Éditer une transaction":"Créer une nouvelle transaction",cancelLabel:"Annuler",confirmLabel:e?.id?"Modifier":"Créer",onConfirm:g,children:a.jsxs("form",{className:"flex flex-col gap-4",children:[a.jsx(I,{label:"Label",name:"label",id:"transaction_label",value:s.label,placeholder:"Label",onChange:l("label"),style:n.label?"error":"neutral",helperText:n.label}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx(I,{label:"Montant",name:"amount",id:"transaction_amount",value:s.amount,type:"number",placeholder:"Montant",onChange:l("amount"),style:n.amount?"error":"neutral",helperText:n.amount})}),a.jsx("div",{className:"flex-1",children:a.jsx(I,{label:"Due le",name:"dueAt",id:"transaction_dueAt",value:s.dueAt,type:"date",placeholder:"Due le",onChange:l("dueAt"),style:n.dueAt?"error":"neutral",helperText:n.dueAt})})]}),a.jsx(A,{id:"transaction_category",name:"category",label:"Categorie",options:b,placeholder:"Choisir une categorie",style:n.categoryId?"error":"neutral",value:s.categoryId,onChange:i=>l("categoryId")(i.target.value),helperText:n.categoryId}),a.jsx(A,{id:"transaction_frequency",name:"frequency",label:"Fréquence",options:t,placeholder:"Choisir une fréquence",style:n.frequencyId?"error":"neutral",value:s.frequencyId||"",onChange:i=>l("frequencyId")(i.target.value),helperText:n.frequencyId})]})})};N.__docgenInfo={description:"",methods:[],displayName:"TransactionModal",props:{transaction:{required:!1,tsType:{name:"Transaction"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{N as T};
