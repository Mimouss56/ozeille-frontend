import{r as t,j as s}from"./iframe-z1zinKTN.js";import{o as R}from"./Pencil.es-DdWOCBPC.js";import{o as $}from"./Wallet.es-DvlRqA1_.js";import{B as E}from"./Button-DGdmapkv.js";import{I as z}from"./InputField-CtrHOFbz.js";import{D as _}from"./DataTable-Cn9xa_nq.js";import{T as Y}from"./TransactionDeleteModal-Bsn6Oa1O.js";import{T as K}from"./TransactionModal-CVXftP3c.js";import{E as L}from"./EmptyCard-BEq0hHJ0.js";import{d as q}from"./dayjs.min-DUlyWteD.js";import{A as w}from"./ActionMenu-DfN7t6oZ.js";import{u as B,b as U}from"./frequenciesStore-B3b6Rooe.js";import{u as W}from"./transactionsStore-Bnn0k51I.js";const V={currency:"€",decimals:2,currencyPosition:"after"};function v(r,o={}){const{currency:i,decimals:n,currencyPosition:c}={...V,...o},l=r.toFixed(n),g=c==="after"?`${l} ${i}`:`${i} ${l}`,u=`${r>0?"text-green-600":"text-red-600"} font-medium`;return t.createElement("span",{className:u},g)}v.__docgenInfo={description:"",methods:[],displayName:"formatAmountWithColor"};const G=()=>q().startOf("month").format("YYYY-MM");function H(){const[r,o]=t.useState(void 0),[i,n]=t.useState(!1),[c,l]=t.useState(!1),[g,d]=t.useState(()=>G()),[u,p]=t.useState(""),{fetchTransactions:f,meta:y,transactions:S}=W(),{fetchCategoriesOptions:h,categoriesOptions:m}=B(),{fetchFrequencies:x,frequencies:C}=U(),a=10,[T,b]=t.useState({pageIndex:0,pageSize:a}),O=t.useCallback(e=>{d(e),b({pageIndex:0,pageSize:a})},[]),F=t.useCallback(()=>{o(void 0),n(!0)},[]),P=t.useCallback(e=>{o(e),n(!0)},[]),I=t.useCallback(e=>{o(e),l(!0)},[]),k=t.useCallback(()=>{n(!1),l(!1),o(void 0)},[]),j=t.useCallback(e=>{p(e),b(N=>({...N,pageIndex:0}))},[]),A=t.useCallback(()=>{p(""),b({pageIndex:0,pageSize:a})},[a]),M=t.useCallback(e=>[{label:"Éditer",style:"outline",onClick:()=>P(e)},{label:"Supprimer",style:"dangerOutline",onClick:()=>I(e)}],[P,I]),D=t.useMemo(()=>[{accessorKey:"dueAt",header:"Date",cell:({row:e})=>new Date(e.original.dueAt).toLocaleDateString()},{accessorKey:"category",header:"Catégorie",cell:({row:e})=>e.original.categoryId?`${e.original.category?.label}`:"Aucune catégorie",enableFiltering:!0,options:{filterOptions:m.map(e=>({value:e.value.toString(),label:e.label})),filterEmptyLabel:"Toutes",isServerSide:!0,onChange:j}},{accessorKey:"amount",header:"Montant",cell:({row:e})=>v(e.original.amount),enableFiltering:!0,options:{filterPlaceholder:"Montant"},currency:!0},{accessorKey:"label",header:"Libellé",enableFiltering:!0,options:{filterPlaceholder:"Rechercher un libellé..."}},{id:"actions",header:"",cell:({row:e})=>t.createElement(w,{actions:M(e.original)})}],[m,j,M]);return t.useEffect(()=>{m.length===0&&h(),C.length===0&&x()},[m.length,h,x,C.length]),t.useEffect(()=>{f({limit:a,page:T.pageIndex+1,categoryId:u||void 0})},[f,a,T.pageIndex,u]),{columns:D,fetchTransactions:f,meta:y,transactions:S,isEditModalOpen:i,isDeleteModalOpen:c,selectedTransaction:r,handleCreate:F,handleEdit:P,handleDelete:I,closeModals:k,page:T,setPage:b,limit:a,period:g,handlePeriodChange:O,resetFilters:A}}const J=()=>{const[r,o]=t.useState(0),{columns:i,meta:n,transactions:c,isEditModalOpen:l,isDeleteModalOpen:g,selectedTransaction:d,handleCreate:u,closeModals:p,page:f,setPage:y,limit:S,period:h,handlePeriodChange:m,resetFilters:x}=H(),C=()=>{x(),o(a=>a+1)};return s.jsxs("div",{className:"flex h-full flex-col gap-4",children:[s.jsx("h1",{className:"text-neutral text-2xl font-bold",children:"Transactions"}),s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-4",children:[s.jsx(z,{id:"transaction-period",label:"Période",name:"period",type:"month",value:h,onChange:a=>m(a.target.value),size:"sm",placeholder:""}),s.jsx(E,{style:"ghostOutline",size:"sm",onClick:C,children:"Réinitialiser les filtres"})]}),s.jsx(E,{onClick:u,icon:R,children:"Nouvelle Transaction"})]}),c.length===0&&s.jsx(L,{icon:$,label:"Aucune transaction",subtitle:"Ajouter une nouvelle transaction"}),s.jsx(_,{pageSize:S,data:c,columns:i,currentPage:f,setCurrentPage:y,totalPage:n.totalPages,paginated:!0,resetFiltersSignal:r}),l&&s.jsx(K,{transaction:d,onClose:p}),g&&d&&s.jsx(Y,{transaction:d,onClose:p})]})};J.__docgenInfo={description:"",methods:[],displayName:"TransactionPage"};export{J as T};
